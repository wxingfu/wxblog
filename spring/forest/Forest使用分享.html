<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Forest使用分享 | wblog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/wxblog/img/common/favicon.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.staticfile.org/jquery/1.7.2/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/wxblog/js/BaiduStatistics.js"></script>
    <meta name="description" content="实践是检验真理的唯一标准">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/wxblog/assets/css/0.styles.5da11931.css" as="style"><link rel="preload" href="/wxblog/assets/js/app.3804bf2c.js" as="script"><link rel="preload" href="/wxblog/assets/js/3.a8328e8d.js" as="script"><link rel="preload" href="/wxblog/assets/js/1.400ebb5b.js" as="script"><link rel="preload" href="/wxblog/assets/js/28.effcadf8.js" as="script"><link rel="prefetch" href="/wxblog/assets/js/10.2f12f8ff.js"><link rel="prefetch" href="/wxblog/assets/js/11.7dc98a2a.js"><link rel="prefetch" href="/wxblog/assets/js/12.f17dd298.js"><link rel="prefetch" href="/wxblog/assets/js/13.5927cd2c.js"><link rel="prefetch" href="/wxblog/assets/js/14.28454129.js"><link rel="prefetch" href="/wxblog/assets/js/15.41b034e0.js"><link rel="prefetch" href="/wxblog/assets/js/16.a9188855.js"><link rel="prefetch" href="/wxblog/assets/js/17.30ee13d8.js"><link rel="prefetch" href="/wxblog/assets/js/18.e1b7b08d.js"><link rel="prefetch" href="/wxblog/assets/js/19.6d9e48b2.js"><link rel="prefetch" href="/wxblog/assets/js/20.cbce0298.js"><link rel="prefetch" href="/wxblog/assets/js/21.52b687b2.js"><link rel="prefetch" href="/wxblog/assets/js/22.4037fcac.js"><link rel="prefetch" href="/wxblog/assets/js/23.0df47bb1.js"><link rel="prefetch" href="/wxblog/assets/js/24.c7ca9647.js"><link rel="prefetch" href="/wxblog/assets/js/25.d8f150e9.js"><link rel="prefetch" href="/wxblog/assets/js/26.c57be89b.js"><link rel="prefetch" href="/wxblog/assets/js/27.b3c25d0d.js"><link rel="prefetch" href="/wxblog/assets/js/29.cb87ed22.js"><link rel="prefetch" href="/wxblog/assets/js/30.6edbb134.js"><link rel="prefetch" href="/wxblog/assets/js/31.b0527609.js"><link rel="prefetch" href="/wxblog/assets/js/4.2028165b.js"><link rel="prefetch" href="/wxblog/assets/js/5.cf8076d0.js"><link rel="prefetch" href="/wxblog/assets/js/6.c6e84f3e.js"><link rel="prefetch" href="/wxblog/assets/js/7.00be7a59.js"><link rel="prefetch" href="/wxblog/assets/js/8.c52bcad7.js"><link rel="prefetch" href="/wxblog/assets/js/9.10774a3d.js">
    <link rel="stylesheet" href="/wxblog/assets/css/0.styles.5da11931.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>wblog</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>实践是检验真理的唯一标准</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>weixf</span>
            
          <span data-v-25ba6db2>2022 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wxblog/" class="home-link router-link-active"><!----> <span class="site-name">wblog</span></a> <div class="links"><!----> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wxblog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxblog/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/后端/" class="nav-link"><i class="undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/数据结构与算法/" class="nav-link"><i class="undefined"></i>
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Servlet/" class="nav-link"><i class="undefined"></i>
  Servlet
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/个人笔记/" class="nav-link"><i class="undefined"></i>
  个人笔记
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/在线工具/" class="nav-link"><i class="undefined"></i>
  在线工具
</a></li></ul></div></div><div class="nav-item"><a href="/wxblog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      基础笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>JavaSE</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/JavaSE/Java基础/" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li><li class="dropdown-subitem"><a href="/wxblog/JavaSE/数据结构和算法/" class="nav-link"><i class="undefined"></i>
  数据结构与算法
</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/MySQL/MySQL基础/" class="nav-link"><i class="undefined"></i>
  MySQL基础
</a></li></ul></li><li class="dropdown-item"><h4>JavaWeb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/JavaWeb/Servlet/Servlet基础/" class="nav-link"><i class="undefined"></i>
  Servlet基础
</a></li><li class="dropdown-subitem"><a href="/wxblog/JavaWeb/Vue/Vue基础/" class="nav-link"><i class="undefined"></i>
  Vue基础
</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/Linux/Linux基础/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>Spring系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/spring/forest/" class="nav-link router-link-active"><i class="undefined"></i>
  Foest使用介绍
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/wxblog/PracticalSkills/" class="nav-link"><i class="undefined"></i>
  零散笔记
</a></div><div class="nav-item"><a href="/wxblog/tools/" class="nav-link"><i class="undefined"></i>
  工具箱
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/wxingfu/wxblog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  编程语言排行榜
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/wxblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><img src="/wxblog/img/common/avatar.png" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    weixf
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>15</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>13</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/wxblog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wxblog/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/后端/" class="nav-link"><i class="undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/数据结构与算法/" class="nav-link"><i class="undefined"></i>
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Servlet/" class="nav-link"><i class="undefined"></i>
  Servlet
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/前端/" class="nav-link"><i class="undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Vue/" class="nav-link"><i class="undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/个人笔记/" class="nav-link"><i class="undefined"></i>
  个人笔记
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/wxblog/categories/在线工具/" class="nav-link"><i class="undefined"></i>
  在线工具
</a></li></ul></div></div><div class="nav-item"><a href="/wxblog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      基础笔记
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>JavaSE</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/JavaSE/Java基础/" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li><li class="dropdown-subitem"><a href="/wxblog/JavaSE/数据结构和算法/" class="nav-link"><i class="undefined"></i>
  数据结构与算法
</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/MySQL/MySQL基础/" class="nav-link"><i class="undefined"></i>
  MySQL基础
</a></li></ul></li><li class="dropdown-item"><h4>JavaWeb</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/JavaWeb/Servlet/Servlet基础/" class="nav-link"><i class="undefined"></i>
  Servlet基础
</a></li><li class="dropdown-subitem"><a href="/wxblog/JavaWeb/Vue/Vue基础/" class="nav-link"><i class="undefined"></i>
  Vue基础
</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/Linux/Linux基础/" class="nav-link"><i class="undefined"></i>
  Linux
</a></li></ul></li><li class="dropdown-item"><h4>Spring系列</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wxblog/spring/forest/" class="nav-link router-link-active"><i class="undefined"></i>
  Foest使用介绍
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/wxblog/PracticalSkills/" class="nav-link"><i class="undefined"></i>
  零散笔记
</a></div><div class="nav-item"><a href="/wxblog/tools/" class="nav-link"><i class="undefined"></i>
  工具箱
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      链接
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/wxingfu/wxblog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-csdn"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  编程语言排行榜
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/wxblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Forest使用分享</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wxblog/spring/forest/Forest使用分享.html" class="active sidebar-link">Forest使用分享</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>weixf</span>
            
          <span data-v-25ba6db2>2022 - </span>
          2023
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Forest使用分享</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>weixf</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="forest使用分享"><a href="#forest使用分享" class="header-anchor">#</a> Forest使用分享</h1> <h2 id="一、forest基本介绍"><a href="#一、forest基本介绍" class="header-anchor">#</a> 一、Forest基本介绍</h2> <h3 id="什么是-forest"><a href="#什么是-forest" class="header-anchor">#</a> 什么是 Forest？</h3> <p>​       Forest是一个开源的Java HTTP客户端框架，它能够将HTTP的所有请求信息（包括URL、Header以及Body等信息）绑定到自定义的Interface方法上，能够通过调用本地接口方法的方式发送HTTP请求</p> <h3 id="为什么使用-forest"><a href="#为什么使用-forest" class="header-anchor">#</a> 为什么使用 Forest?</h3> <p>​       使用Forest就像使用类似Dubbo那样的RPC框架一样，只需要定义接口，调用接口即可，不必关心具体发送HTTP请求的细节。同时将HTTP请求信息与业务代码解耦，可以方便统一管理大量HTTP的URL、Header等信息。而请求的调用方完全不必在意HTTP的具体内容，即使该HTTP请求信息发生变更，大多数情况也不需要修改调用发送请求的代码</p> <h3 id="forest-如何使用"><a href="#forest-如何使用" class="header-anchor">#</a> Forest 如何使用?</h3> <p>​        Forest不需要编写具体的HTTP调用过程，只需要定义一个接口，然后通过Forest注解将HTTP请求的信息添加到接口的方法上即可。请求发送方通过调用定义的接口便能自动发送请求和接受请求的响应</p> <h3 id="forest-的工作原理"><a href="#forest-的工作原理" class="header-anchor">#</a> Forest 的工作原理</h3> <p>​        Forest会将定义好的接口通过动态代理的方式生成一个具体的实现类，然后组织、验证HTTP请求信息，绑定动态数据，转换数据形式，SSL验证签名，调用后端HTTP API(httpclient等API)执行实际请求，等待响应，失败重试，转换响应数据到Java类型等脏活累活都由这动态代理的实现类给包了。请求发送方调用这个接口时，实际上就是在调用这个干脏活累活的实现类</p> <h3 id="forest-的架构"><a href="#forest-的架构" class="header-anchor">#</a> Forest 的架构</h3> <img src="/images/forest-architecture.svg" alt="forest-architecture" style="zoom:80%;"> <h4 id="前端部分"><a href="#前端部分" class="header-anchor">#</a> <strong>前端部分</strong></h4> <ol><li>Forest 配置： 负责管理 HTTP 发送请求所需的配置。</li> <li>Forest 注解： 用于定义 HTTP 发送请求的所有相关信息，一般定义在 interface 上和其方法上。</li> <li>动态代理： 用户定义好的 HTTP 请求的<code>interface</code>将通过动态代理产生实际执行发送请求过程的代理类。</li> <li>模板表达式： 模板表达式可以嵌入在几乎所有的 HTTP 请求参数定义中，它能够将用户通过参数或全局变量传入的数据动态绑定到 HTTP 请求信息中。</li> <li>数据转换： 此模块将字符串数据和<code>JSON</code>或<code>XML</code>形式数据进行互转。目前 JSON 转换器支持<code>Jackson</code>、<code>Fastjson</code>、<code>Gson</code>三种，XML 支持<code>JAXB</code>一种。</li> <li>拦截器： 用户可以自定义拦截器，拦截指定的一个或一批请求的开始、成功返回数据、失败、完成等生命周期中的各个环节，以插入自定义的逻辑进行处理。</li> <li>过滤器： 用于动态过滤和处理传入 HTTP 请求的相关数据。</li> <li>SSL： Forest 支持单向和双向验证的 HTTPS 请求，此模块用于处理 SSL 相关协议的内容。</li></ol> <h4 id="后端部分"><a href="#后端部分" class="header-anchor">#</a> <strong>后端部分</strong></h4> <p>​       后端为实际执行 HTTP 请求发送过程的第三方 HTTP API，目前支持<code>okHttp3</code>和<code>httpclient</code>两种后端 API。</p> <h3 id="所需环境"><a href="#所需环境" class="header-anchor">#</a> 所需环境</h3> <p>JDK 8+</p> <h3 id="名字由来"><a href="#名字由来" class="header-anchor">#</a> 名字由来</h3> <p>​        Forest就字面意思而言，就是森林的意思。但仔细看可以拆成<code>For</code>和<code>Rest</code>两个单词，也就是“为了Rest”（Rest为一种基于HTTP的架构风格）。 而合起来就是森林，森林由很多树木花草组成（可以理解为各种不同的服务），它们表面上看独立，实则在地下根茎交错纵横、相互连接依存，这样看就有点现代分布式服务化的味道了。 最后，这两个单词反过来读就像是<code>Resultful</code>。</p> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <h4 id="容易上手"><a href="#容易上手" class="header-anchor">#</a> 容易上手</h4> <blockquote><p>10分钟可完成请求的定义、发送、接收、解析、错误处理、日志打印等过程，此外还有直观的API和详尽的文档</p></blockquote> <h4 id="简单优雅"><a href="#简单优雅" class="header-anchor">#</a> 简单优雅</h4> <blockquote><p>将繁复的HTTP请求细节封装成Java接口+注解的形式，不必关心请求发送的具体过程</p></blockquote> <h4 id="扩展灵活"><a href="#扩展灵活" class="header-anchor">#</a> 扩展灵活</h4> <blockquote><p>能使用自定义拦截器和自定义注解来扩展Forest的能力，即使面对意想不到的场景也能轻松应对</p></blockquote> <h2 id="二、极速入门"><a href="#二、极速入门" class="header-anchor">#</a> 二、极速入门</h2> <p>​        在Forest中，所有的HTTP请求信息都要绑定到某一个接口的方法上，不需要编写具体的代码去发送请求。请求发送方通过调用事先定义好HTTP请求信息的接口方法，自动去执行HTTP发送请求的过程，其具体发送请求信息就是该方法对应绑定的HTTP请求信息</p> <p>以下例子基于Spring Boot</p> <h3 id="第一步-添加maven依赖"><a href="#第一步-添加maven依赖" class="header-anchor">#</a> 第一步：添加Maven依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.dtflys.forest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>forest-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.31<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="第二步-创建接口"><a href="#第二步-创建接口" class="header-anchor">#</a> 第二步：创建接口</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AmapClient</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://ditu.amap.com/service/regeo?longitude={0}&amp;latitude={1}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Map</span> <span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token class-name">String</span> longitude<span class="token punctuation">,</span> <span class="token class-name">String</span> latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="第三步-扫描接口"><a href="#第三步-扫描接口" class="header-anchor">#</a> 第三步：扫描接口</h3> <p>在Spring Boot的配置类或者启动类上加上<code>@ForestScan</code>注解，并在<code>basePackages</code>属性里填上远程接口的所在的包名。</p> <blockquote><p>1.5.1以后版本可以跳过此步，不需要 @ForestScan 注解来指定扫描的包范围</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ForestScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.yoursite.client&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="第四步-调用接口"><a href="#第四步-调用接口" class="header-anchor">#</a> 第四步：调用接口</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 注入接口实例</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">AmapClient</span> amapClient<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// 调用接口</span>
<span class="token class-name">Map</span> result <span class="token operator">=</span> amapClient<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token string">&quot;121.475078&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;31.223577&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>发送JSON数据</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 将对象参数解析为JSON字符串，并放在请求的Body进行传输
 */</span>
<span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">registerUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@JSONBody</span> <span class="token class-name">MyUser</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>发送XML数据</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 将一个通过JAXB注解修饰过的类型对象解析为XML字符串
 * 并放在请求的Body进行传输
 */</span>
<span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/message&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">sendXmlMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@XMLBody</span> <span class="token class-name">MyMessage</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>文件上传</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用@DataFile注解修饰要上传的参数对象
 * OnProgress参数为监听上传进度的回调函数
 */</span>
<span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Map</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@DataFile</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> filePath<span class="token punctuation">,</span> <span class="token class-name">OnProgress</span> onProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>多文件批量上传</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 上传Map包装的文件列表，其中 {_key} 代表Map中每一次迭代中的键值
 */</span>
<span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">ForestRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> <span class="token function">uploadByteArrayMap</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@DataFile</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> fileName <span class="token operator">=</span> <span class="token string">&quot;{_key}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> byteArrayMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>文件下载</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 在方法上加上@DownloadFile注解
 * dir属性表示文件下载到哪个目录
 * OnProgress参数为监听上传进度的回调函数
 * {0}代表引用第一个参数
 */</span>
<span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/images/xxx.jpg&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DownloadFile</span><span class="token punctuation">(</span>dir <span class="token operator">=</span> <span class="token string">&quot;{0}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">File</span> <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> dir<span class="token punctuation">,</span> <span class="token class-name">OnProgress</span> onProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>基本签名验证</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/hello/user?username={username}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@BasicAuth</span><span class="token punctuation">(</span>username <span class="token operator">=</span> <span class="token string">&quot;{username}&quot;</span><span class="token punctuation">,</span> password <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token annotation punctuation">@DataVariable</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>等等…</strong></p> <h2 id="三、安装配置说明"><a href="#三、安装配置说明" class="header-anchor">#</a> 三、安装配置说明</h2> <h3 id="如何安装"><a href="#如何安装" class="header-anchor">#</a> 如何安装</h3> <p>Forest 可适配集成 Springboot、Spring 等多种不同的项目环境，也可直接在普通的 Java 项目中使用</p> <p>可以根据项目需要，选择不同的环境进行安装</p> <ul><li><p>Springboot环境安装</p> <p>引入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--Forest Starter--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.dtflys.forest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>forest-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>Spring环境安装</p> <p>引入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--Forest核心--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.dtflys.forest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>forest-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--Forest和Spring整合包--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.dtflys.forest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>forest-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>原生Java环境安装</p> <p>引入依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--Forest核心--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.dtflys.forest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>forest-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--JSON--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-annotations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--日志--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.36<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></li></ul> <h3 id="如何配置"><a href="#如何配置" class="header-anchor">#</a> 如何配置</h3> <p>Forest 遵循约定大于配置的理念，大多数情况下不需要进行配置，或填写非常简单的配置即可</p> <p>但不同项目环境配置方式各有不同，需要根据项目需要，选择不同的环境进行配置</p> <ul><li><p>Springboot环境配置</p> <p>简单配置：在<code>application.yaml</code> / <code>application.properties</code>中配置的 HTTP 基本参数</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">forest</span><span class="token punctuation">:</span>
  <span class="token key atrule">max-connections</span><span class="token punctuation">:</span> <span class="token number">1000</span>        <span class="token comment"># 连接池最大连接数</span>
  <span class="token key atrule">connect-timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>        <span class="token comment"># 连接超时时间，单位为毫秒</span>
  <span class="token key atrule">read-timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>           <span class="token comment"># 数据读取超时时间，单位为毫秒</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Spring环境配置</p> <p>简单配置：</p> <p>配置 XML SCEHEMA</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>forest</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://forest.dtflyx.com/schema/forest<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://forest.dtflyx.com/schema/forest
       http://forest.dtflyx.com/schema/forest/forest-spring.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>添加Forest基本配置的定义</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- Forest 全局配置 --&gt;</span>
<span class="token comment">&lt;!-- maxConnections 每个路由的最大连接数 --&gt;</span>
<span class="token comment">&lt;!-- connectTimeout 连接超时时间，单位为毫秒 --&gt;</span>
<span class="token comment">&lt;!-- readTimeout 数据读取超时时间，单位为毫秒 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">forest:</span>configuration</span>
        <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>configuration<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">maxConnections</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">connectTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">readTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 定义 Forest 客户端接口所在的包名 --&gt;</span>
    <span class="token comment">&lt;!-- 扫描 base-package 属性定义包，然后会将该包名下符合条件的接口进行动态代理并注入到 Spring 的上下文中 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">forest:</span>scan</span> <span class="token attr-name">configuration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>configuration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.yoursite.client<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">forest:</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>原生Java环境配置</p> <p>简单配置：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 获取 Forest 全局配置对象</span>
<span class="token class-name">ForestConfiguration</span> configuration <span class="token operator">=</span> <span class="token class-name">Forest</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 连接池最大连接数</span>
configuration<span class="token punctuation">.</span><span class="token function">setMaxConnections</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 连接超时时间，单位为毫秒</span>
configuration<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 数据读取超时时间，单位为毫秒</span>
configuration<span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h3 id="如何使用"><a href="#如何使用" class="header-anchor">#</a> 如何使用</h3> <p>Forest 提供两种开发使用模式：<code>声明式</code>和<code>编程式</code></p> <p><code>声明式</code>需要定义Java接口，以及请求对应的接口方法，这样会有一个非常清晰的网络接口结构，十分有利于API管理</p> <p>声明式的模式在不同项目环境中也有所不同，需要根据项目需要，选择不同的方式进行开发</p> <ul><li>Springboot环境使用</li> <li>Spring环境使用</li> <li>原生Java环境使用</li></ul> <p>Forest也提供了快捷的编程式接口，以满足非声明式的开发模式</p> <p><code>编程式</code>接口短小精悍，快速便捷，十分有利于开发那些数量少、或大量参数（如URL）不固定的API</p> <h2 id="四、声明式开发模式"><a href="#四、声明式开发模式" class="header-anchor">#</a> 四、声明式开发模式</h2> <h3 id="第一步-定义java接口"><a href="#第一步-定义java接口" class="header-anchor">#</a> 第一步：定义Java接口</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-get&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">helloGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-post&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">helloPost</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 通过@Request注解，将simpleRequest()方法绑定了一个 HTTP 请求，
     * 其 URL 为http://localhost:8080/hello ，并默认使用GET方式，
     * 且将请求响应的数据以String的方式返回给调用者
     */</span>
    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">simpleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * sendRequest方法绑定的 HTTP 请求，定义了 URL 信息，以及把Accept:text/plain加到了请求头中，
     * 方法的参数String username绑定了注解@Query(&quot;uname&quot;)，
     * 它的作用是将调用者传入入参 username 时，自动将username的值加入到 HTTP 的请求参数uname中
     */</span>
    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/user&quot;</span><span class="token punctuation">,</span>headers <span class="token operator">=</span> <span class="token string">&quot;Accept: text/plain&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;uname&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="第二步-调用接口"><a href="#第二步-调用接口" class="header-anchor">#</a> 第二步：调用接口</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForestClientAppTest</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">MyClient</span> myClient<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> myClient<span class="token punctuation">.</span><span class="token function">helloGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> myClient<span class="token punctuation">.</span><span class="token function">helloPost</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> myClient<span class="token punctuation">.</span><span class="token function">simpleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> myClient<span class="token punctuation">.</span><span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token string">&quot;小明&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="请求代码解析"><a href="#请求代码解析" class="header-anchor">#</a> 请求代码解析</h3> <p>Forest 使用不同的<strong>请求注解</strong>来标识某个接口方法来进行发送不同类型的请求，其支持的HTTP方法如下表所示:</p> <table><thead><tr><th>HTTP 请求方法</th> <th>请求注解</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>GET</strong></td> <td><code>@Get</code>、<code>@GetRequest</code></td> <td>获取资源</td></tr> <tr><td><strong>POST</strong></td> <td><code>@Post</code>、<code>@PostRequest</code></td> <td>传输实体文本</td></tr> <tr><td><strong>PUT</strong></td> <td><code>@Put</code>、<code>@PutRequest</code></td> <td>上传资源</td></tr> <tr><td><strong>HEAD</strong></td> <td><code>@HeadRequest</code></td> <td>获取报文首部</td></tr> <tr><td><strong>DELETE</strong></td> <td><code>@Delete</code>、<code>@DeleteRequest</code></td> <td>删除资源</td></tr> <tr><td><strong>OPTIONS</strong></td> <td><code>@Options</code>、<code>@OptionsRequest</code></td> <td>询问支持的方法</td></tr> <tr><td><strong>TRACE</strong></td> <td><code>@Trace</code>、<code>@TraceRequest</code></td> <td>追踪路径</td></tr> <tr><td><strong>PATCH</strong></td> <td><code>@Patch</code>、<code>@PatchRequest</code></td> <td>更新资源的某一部分</td></tr> <tr><td><strong>不定方法</strong></td> <td><code>@Request</code></td> <td>可动态传入HTTP方法</td></tr></tbody></table> <p><strong>接口注解：</strong></p> <p><code>@BaseRequest</code></p> <blockquote><p><code>@BaseRequest</code>注解定义在接口类上，在<code>@BaseRequest</code>上定义的属性会被分配到该接口中每一个方法上，但方法上定义的请求属性会覆盖<code>@BaseRequest</code>上重复定义的内容。 因此可以认为<code>@BaseRequest</code>上定义的属性内容是所在接口中所有请求的默认属性。</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @BaseRequest 为配置接口层级请求信息的注解
 * 其属性会成为该接口下所有请求的默认属性
 * 但可以被方法上定义的属性所覆盖
 */</span>
<span class="token annotation punctuation">@BaseRequest</span><span class="token punctuation">(</span>
    baseURL <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// 默认域名</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Accept:text/plain&quot;</span>                <span class="token comment">// 默认请求头</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    sslProtocol <span class="token operator">=</span> <span class="token string">&quot;TLS&quot;</span>                    <span class="token comment">// 默认单向SSL协议</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
  
    <span class="token comment">// 方法的URL不必再写域名部分</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/hello/user&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 若方法的URL是完整包含http://开头的，那么会以方法的URL中域名为准，不会被接口层级中的baseURL属性覆盖</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.xxx.com/hello/user&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span>
        url <span class="token operator">=</span> <span class="token string">&quot;/hello/user&quot;</span><span class="token punctuation">,</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Accept:application/json&quot;</span>      <span class="token comment">// 覆盖接口层级配置的请求头信息</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>     
    <span class="token class-name">String</span> <span class="token function">send3</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>既可以做接口注解也可以做方法注解：</strong></p> <p><code>@Backend</code>：为接口下的每一个方法请求设置HTTP后端框架</p> <p><code>@Address</code>：将URL地址提取出来，方便管理</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @Backend 是一个方法维度的注解，但也可以挂在接口上
 * 它可以为接口下的每一个方法请求设置HTTP后端框架
 * 所以该接口下所有请求默认都会使用 OkHttp3
 */</span>
<span class="token annotation punctuation">@Backend</span><span class="token punctuation">(</span><span class="token string">&quot;okhttp3&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Address</span><span class="token punctuation">(</span>host <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token string">&quot;8080&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 使用接口默认后端框架，即 OkHttp3
     */</span>
    <span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/data1&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">sendData1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyData</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 使用接口默认后端框架，即 OkHttp3
     */</span>
    <span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/data2&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Address</span><span class="token punctuation">(</span>host <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token string">&quot;8088&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">sendData2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyData</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 使用了接口上相同的注解 @Backend
     * 覆盖了改接口默认后端框架配置
     * 所以该请求会使用 HttpClient 作为后端框架
     */</span>
    <span class="token annotation punctuation">@Backend</span><span class="token punctuation">(</span><span class="token string">&quot;httpclient&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;/data3&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">sendData3</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyData</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="接收数据"><a href="#接收数据" class="header-anchor">#</a> 接收数据</h3> <p>Forest请求会自动将响应的返回数据反序列化成想要的数据类型。想要接受指定类型的数据需要完成两步操作：</p> <p><strong>第一步</strong>：定义<code>dataType</code>属性</p> <p><code>dataType</code>属性指定了该请求响应返回的数据类型，目前可选的数据类型有三种: <code>text</code>, <code>json</code>, <code>xml</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * dataType为text或不填时，请求响应的数据将以文本字符串的形式返回回来
 */</span>
<span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/text/data&quot;</span><span class="token punctuation">,</span>
    dataType <span class="token operator">=</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>第二步</strong>：指定反序列化的目标类型</p> <p>反序列化需要一个目标类型，而该类型其实就是方法的返回值类型，如返回值为<code>String</code>就会反序列成<code>String</code>字符串，返回值为<code>Map</code>就会反序列化成一个HashMap对象，也可以指定为自定义的Class类型</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * dataType属性指明了返回的数据类型为JSON
 */</span>
<span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/user?id=${0}&quot;</span><span class="token punctuation">,</span>
    dataType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="返回请求对象"><a href="#返回请求对象" class="header-anchor">#</a> 返回请求对象</h4> <p>将<code>ForestRequest</code>作为请求方法的返回值类型，调用该方法时不会立即执行请求发送的过程，而是直接返回一个<code>ForestRequest</code>对象，可以延迟发送HTTP请求，并对要即将发送的请求参数做进一步的修改和加工</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyForestClient</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">ForestRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getForestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在调用<code>getForestRequest()</code>方法后获得该请求方法所对应的请求对象。获得 Forest 请求对象时并不会自动发送请求，需要调用<code>execute()</code>或<code>execute(Class)</code>这类方法手动执行请求发送的过程。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ForestRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request <span class="token operator">=</span> myForestClient<span class="token punctuation">.</span><span class="token function">getForestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> path <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> ret <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="返回响应对象"><a href="#返回响应对象" class="header-anchor">#</a> 返回响应对象</h4> <p>直接用普通的对象类型作为请求方法的返回类型，可以将响应数据方便的反序列化，以满足大部分的需求。但还有很多时候不光需要获取响应内容，也需要得到响应头等信息，这时候就需要 <code>ForestResponse</code> 来处理</p> <p>将<code>ForestResponse</code>作为请求方法的返回值类型</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/user&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">ForestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">postUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@JSONBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>用<code>ForestResponse</code>对象接到请求响应数据后便可以获取响应内容</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 以ForestResponse类型变量接受响应数据</span>
<span class="token class-name">ForestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">postUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 用isError方法去判断请求是否失败</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用isSuccess方法去判断请求是否成功</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token comment">// 以字符串方式读取请求响应内容</span>
<span class="token class-name">String</span> text <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">readAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// getContent方法可以获取请求响应内容文本</span>
<span class="token comment">// 和readAsString方法不同的地方在于，getContent方法不会读取二进制形式数据内容，</span>
<span class="token comment">// 而readAsString方法会将二进制数据转换成字符串读取</span>
<span class="token class-name">String</span> content <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取反序列化成对象类型的请求响应内容</span>
<span class="token comment">// 因为返回类型为ForetReponse&lt;String&gt;, 其泛型参数为String</span>
<span class="token comment">// 所以这里也用String类型获取结果        </span>
<span class="token class-name">String</span> result <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 以字节数组的形式获取请求响应内容</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> byteArray <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 以输入流的形式获取请求响应内容</span>
<span class="token class-name">InputStream</span> in <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="拦截器中获取响应对象"><a href="#拦截器中获取响应对象" class="header-anchor">#</a> 拦截器中获取响应对象</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleInterceptor1</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterExecute</span><span class="token punctuation">(</span><span class="token class-name">ForestRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ForestResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行在发送请求之后处理的代码</span>
        <span class="token keyword">int</span> status <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求响应状态码</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求的响应内容</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取方法返回类型对应的最终数据结果</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="回调函数中获取响应对象"><a href="#回调函数中获取响应对象" class="header-anchor">#</a> 回调函数中获取响应对象</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">postUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@JSONBody</span> <span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">OnSuccess</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> onSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
client<span class="token punctuation">.</span><span class="token function">postUser</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span> resText<span class="token punctuation">,</span> <span class="token class-name">ForestRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ForestResponse</span> response<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在成功接收请求响应后处理</span>
    <span class="token keyword">int</span> status <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求响应状态码</span>
    <span class="token class-name">String</span> content <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取请求的响应内容</span>
    <span class="token class-name">String</span> result <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取方法返回类型对应的最终数据结果</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="获取响应头"><a href="#获取响应头" class="header-anchor">#</a> 获取响应头</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ForestResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">textXXX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据响应头名称获取单个请求响应头</span>
<span class="token class-name">ForestHeader</span> header <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 响应头名称</span>
<span class="token class-name">String</span> headerName <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 响应头值</span>
<span class="token class-name">String</span> headerValue <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据响应头名称获取请求响应头列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ForestHeader</span><span class="token punctuation">&gt;</span></span> heaers <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据响应头名称获取请求响应头值</span>
<span class="token class-name">String</span> val <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHeaderValue</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据响应头名称获取请求响应头值列表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> vals <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHeaderValues</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="数据转换"><a href="#数据转换" class="header-anchor">#</a> 数据转换</h4> <h5 id="序列化"><a href="#序列化" class="header-anchor">#</a> 序列化</h5> <p><strong>序列化</strong>是指，将原始的 Java 类型数据对象转化为 HTTP 请求想要发送的数据格式（如：<strong>JSON</strong>、<strong>XML</strong>、<strong>Protobuf</strong> 等）</p> <p><strong>Content-Type 请求头</strong></p> <p>Forest中对数据进行序列化可以通过指定<code>contentType</code>属性或<code>Content-Type</code>头指定内容格式</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/user&quot;</span><span class="token punctuation">,</span>
      contentType <span class="token operator">=</span> <span class="token string">&quot;application/json&quot;</span>    <span class="token comment">// 指定contentType为application/json</span>
<span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">postJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyUser</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 自动将user对象序列化为JSON格式</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>请求体类型</strong>
可以通过<code>@BodyType</code>注解指定<code>type</code>属性</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 自动将user对象序列化为JSON格式</span>
<span class="token comment">// 但此方式不会在请求中带有 Content-Type 请求头</span>
<span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/hello/user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@BodyType</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">postJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyUser</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Encoder</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 指定仅仅使用 Jackson 转换器来序列化数据</span>
<span class="token annotation punctuation">@Post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/hello/user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@BodyType</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> encoder <span class="token operator">=</span> <span class="token class-name">ForestJacksonConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> <span class="token function">postJson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyUser</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="反序列化"><a href="#反序列化" class="header-anchor">#</a> 反序列化</h5> <p><strong>反序列化</strong>则是正好与<strong>序列化</strong>的逆过程，是将远端服务接受到的原始数据格式（如：<strong>JSON</strong>、<strong>XML</strong>、<strong>Protobuf</strong> 等）转换为在 Java 程序中可以方便读取操作的 Java 数据对象</p> <p><strong>自动识别结果数据类型</strong></p> <p>Forest 会将根据返回结果自动识别响应的数据格式，并进行反序列化转换</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 如结果是一串类似 {&quot;a&quot;: 1, &quot;b&quot;: 2} 形式的JSON字符串</span>
<span class="token comment">// 则会自动识别并进行转换</span>
<span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/data&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Map</span> <span class="token function">getDataAsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 自动识别转换为 Map 对象</span>

<span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/data&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">MyData</span> <span class="token function">getMyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 自动识别转换为自定义类型对象</span>

<span class="token comment">// 如结果是一串 XML 字符串</span>
<span class="token comment">// 也能自动识别并转换</span>
<span class="token comment">// 但前提是自定义的类型要有 JAXB 注解标注        </span>
<span class="token class-name">MyXmlData</span> <span class="token function">getXmlData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果结果是一串类似 [{&quot;name&quot;: &quot;xxx&quot;}, {&quot;name&quot;: &quot;yyy&quot;}] 格式的 JSON 数组字符串</span>
<span class="token comment">// Forest 也一样能自动识别并转换为 Java 集合对象</span>
<span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080/data/list&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyData</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>指定结果数据类型</strong></p> <p>可以通过<code>dataType</code>指定返回数据的反序列化格式</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/data&quot;</span><span class="token punctuation">,</span>
    dataType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span> <span class="token comment">// 指定dataType为json，将按JSON格式反序列化数据</span>
<span class="token punctuation">)</span>
<span class="token class-name">Map</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求响应的结果将被转换为Map类型对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Decoder</strong></p> <p>Forest 也可以通过请求注解 (诸如：<code>@Request</code>、<code>@Get</code>、<code>@Post</code> 等) 的<code>decoder</code>属性来指定具体处理该请求结果的反序列化的转换器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 指定由 Jackson 转换器处理请求的反序列化</span>
<span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/data&quot;</span><span class="token punctuation">,</span>
    decoder <span class="token operator">=</span> <span class="token class-name">ForestJacksonConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span>
<span class="token punctuation">)</span>
<span class="token class-name">Map</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Forest提供了默认的转换器</strong>，其分成五大类：文本转换器、JSON转换器、XML转换器、二进制转换器、自动转换器。 各大类还可以继续细分为更具体的转换器，可以按类继承理解其分类。</p> <p>可以替换和使用的转换器类如下表：</p> <table><thead><tr><th>转换器类</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>DefaultTextConverter</td> <td>text</td> <td>默认文本数据转换器</td></tr> <tr><td>ForestFastjsonConverter</td> <td>json</td> <td>基于Fastjson框架的JSON转换器</td></tr> <tr><td>ForestJacksonConverter</td> <td>json</td> <td>基于Jackson框架的JSON转换器</td></tr> <tr><td>ForestGsonConverter</td> <td>json</td> <td>基于Gson框架的JSON转换器</td></tr> <tr><td>ForestJaxbConverter</td> <td>xml</td> <td>基于Jaxb框架的XML转换器</td></tr> <tr><td>DefaultBinaryConverter</td> <td>binary</td> <td>默认二进制转换器，多在文件下载时使用</td></tr> <tr><td>DefaultAutoConverter</td> <td>auto</td> <td>自动类型转换器，可以根据响应返回的数据自动嗅探数据类型并使用对应的转换器进行转换</td></tr></tbody></table> <p><strong>配置全局转换器</strong></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># 转换器配置，支持 json, xml, text, binary 四种数据类型的配置</span>
<span class="token comment"># JSON转换器</span>
<span class="token comment"># JSON转换器设置为Jackson的转换器</span>
<span class="token attr-name">forest.converters.json.type</span><span class="token punctuation">=</span><span class="token attr-value">com.dtflys.forest.converter.json.ForestJacksonConverter</span>
<span class="token comment"># JSON转换器设置为GSON转换器</span>
<span class="token comment"># forest.converters.json.type=com.dtflys.forest.converter.json.ForestGsonConverter</span>
<span class="token comment"># JSON转换器设置为Fastjson转换器</span>
<span class="token comment"># forest.converters.json.type=com.dtflys.forest.converter.json.ForestFastjsonConverter</span>
<span class="token comment"># 转换器的参数设置</span>
<span class="token comment"># JSON数据转换器的全局日期格式化配置</span>
<span class="token attr-name">forest.converters.json.parameters.dateFormat</span><span class="token punctuation">:</span> <span class="token attr-value">yyyy/MM/dd HH:mm:ss   </span>
<span class="token comment"># XML转换器</span>
<span class="token comment"># 配置为JAXB转换器</span>
<span class="token attr-name">forest.converters.xml.type</span><span class="token punctuation">=</span><span class="token attr-value">com.dtflys.forest.converter.xml.ForestJaxbConverter</span>
<span class="token comment"># 二进制转换器</span>
<span class="token comment"># 配置为Forest默认二进制转换器</span>
<span class="token attr-name">forest.converters.binary.type</span><span class="token punctuation">:</span> <span class="token attr-value">com.dtflys.forest.converter.binary.DefaultBinaryConverter</span>
<span class="token comment"># 文本转换器</span>
<span class="token comment"># 配置为Forest默认文本转换器</span>
<span class="token attr-name">forest.converters.text.type</span><span class="token punctuation">:</span> <span class="token attr-value">com.dtflys.forest.converter.text.DefaultTextConverter</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>配置接口/方法级别转换器</strong></p> <p>使用<code>@BodyType</code>注解定义<strong>encoder</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 接口级别转换器定义</span>
<span class="token annotation punctuation">@BodyType</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> encoder <span class="token operator">=</span> <span class="token class-name">ForestJacksonConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法级别转换器定义</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@BodyType</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> encoder <span class="token operator">=</span> <span class="token class-name">ForestFastjsonConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyData</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>此外<code>Forest</code>还有</p> <p>请求<strong>成功/失败条件</strong>处理、请求<strong>重试机制</strong>、请求<strong>重定向</strong>、<strong>Gzip解压</strong>、<strong>日志管理</strong></p> <p><strong>回调函数</strong>、<strong>异步请求</strong>、<strong>HTTPS</strong>、<strong>Cookie</strong>使用、<strong>代理</strong>使用、<strong>上传下载</strong>、<strong>异常处理</strong>等功能</p></blockquote> <h2 id="五、编程式开发模式"><a href="#五、编程式开发模式" class="header-anchor">#</a> 五、编程式开发模式</h2> <p>直接使用Forest静态类调用方法</p> <p><strong>Get请求</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get请求</span>
    <span class="token comment">// 并以 String 类型接受数据</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token class-name">Forest</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Post请求</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Post请求</span>
    <span class="token comment">// 并以自定义的 MyResult 类型接受</span>
    <span class="token class-name">MyResult</span> myResult <span class="token operator">=</span> <span class="token class-name">Forest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-post3&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">MyResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>myResult<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>以自定义类型形式接受响应数据</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Post请求</span>
    <span class="token comment">// 并以自定义的 MyResult 类型接受</span>
    <span class="token class-name">MyResult</span> myResult <span class="token operator">=</span> <span class="token class-name">Forest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-post3&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">MyResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>myResult<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>以带复杂泛型参数的类型形式接受响应数据</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过 TypeReference 引用类传递泛型参数</span>
    <span class="token comment">// 就可以将响应数据以带复杂泛型参数的类型接受了</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> <span class="token class-name">Forest</span>
        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-post4&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>定义请求的各种参数</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义各种参数</span>
    <span class="token comment">// 并以 Map 类型接受</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token class-name">Forest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8088/test/hello-post5&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">backend</span><span class="token punctuation">(</span><span class="token string">&quot;okhttp3&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 设置后端为 okhttp3</span>
        <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span>         <span class="token comment">// 设置地址的host为 127.0.0.1</span>
        <span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token number">8088</span><span class="token punctuation">)</span>                <span class="token comment">// 设置地址的端口为 8080</span>
        <span class="token punctuation">.</span><span class="token function">contentTypeJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">// 设置 Content-Type 头为 application/json</span>
        <span class="token punctuation">.</span><span class="token function">addBody</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>           <span class="token comment">// 添加 Body 项(键值对)： a, 1</span>
        <span class="token punctuation">.</span><span class="token function">addBody</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>           <span class="token comment">// 添加 Body 项(键值对：  b, 2</span>
        <span class="token punctuation">.</span><span class="token function">maxRetryCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 设置请求最大重试次数为 3</span>
        <span class="token comment">// 设置 onSuccess 回调函数</span>
        <span class="token punctuation">.</span><span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置 onError 回调函数</span>
        <span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置请求成功判断条件回调函数</span>
        <span class="token punctuation">.</span><span class="token function">successWhen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> res<span class="token punctuation">.</span><span class="token function">noException</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span><span class="token function">statusOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 执行并返回Map数据类型对象</span>
        <span class="token punctuation">.</span><span class="token function">executeAsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><blockquote><p>其他诸多功能与声明式一致，只是使用方式为编程式</p></blockquote> <h2 id="六、模板表达式和高级特性"><a href="#六、模板表达式和高级特性" class="header-anchor">#</a> 六、模板表达式和高级特性</h2> <h3 id="模板表达式"><a href="#模板表达式" class="header-anchor">#</a> 模板表达式</h3> <p>在<code>@Request</code>的各大属性中大多数都是用<code>String</code>字符串填值的，如果要在这些字符串属性中动态地关联参数数据，用Java原生字符串连接(如<code>+</code>)是不行的，而且也不够直观。所以Forest为了帮助您参数数据动态绑定到这些属性上，提供了模板表达式</p> <p>Forest的模板表达式是在普通的Java字符串中嵌入<code>{表达式}</code>来实现字符串和数据的动态绑定。嵌入的表达式由左花括号<code>{</code>开始，到右花括号<code>}</code>结束，在两边花括号中间填写的内容是表达式的本体。最简单的表达式可以是一个<code>@Var</code>标注的变量名，或是一个全局配置中定义的全局变量名</p> <p>简单例子：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/{name}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>或者</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/${name}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="表达式-与-表达式"><a href="#表达式-与-表达式" class="header-anchor">#</a> {表达式} 与 ${表达式}</h4> <p><strong><code>{表达式}</code>代表一个Query参数</strong></p> <p><code>{表达式}</code>模板参数，在<code>?a={a}</code>的情况下，会被认为是一个Query参数，即便变量可能包含&quot;1&amp;x=10&amp;y=20&quot;这样多个参数的字符串，也会被转义成一个Query参数</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/data?a={a}&amp;b={b}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">// 最终产生的URL是</span>
<span class="token comment">// http://localhost/data?a=1%26x%3D10%26y%3D20&amp;b=hello</span>
<span class="token comment">// 也就是只会有 a 和 b 两个Query参数</span>
myClient<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;1&amp;x=10&amp;y=20&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong><code>${表达式}</code>可以包含多个Query参数</strong></p> <p>而 <code>${表达式}</code>模板参数，可以认为是一种字符串替换，替换完再对URL参数进行解析，所以一个模板参数引用的变量中可能包含多个参数，也会被解析成多个参数</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/data?a=${a}&amp;b=${b}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">// 最终产生的URL是</span>
<span class="token comment">// http://localhost/data?a=1&amp;x=10&amp;y=20&amp;b=hello</span>
<span class="token comment">// 也就是只会有 a、x、y、b 四个Query参数</span>
myClient<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;1&amp;x=10&amp;y=20&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>推荐使用<code>{表达式}</code>作为模板参数</strong></p> <p>基于这两种模板参数各自的特性，都各有各的用处，但一般情况下，<strong>推荐使用<code>{表达式}</code></strong></p> <p>因为它更结构化、更语义化，也更容易让人理解，不容易出错，尤其是在URL参数中传递另一个URL地址时的作用更为突出</p> <p>比如，要传一个带参数的子URL：<code>https://search.gitee.com/?type=repository&amp;q=forest</code></p> <p>接到父URL后为 <code>http://localhost/data?call={url}</code></p> <p><code>${表达式}</code>产生的效果</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/data?call=${url}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 最后产生的URL是</span>
    <span class="token comment">// http://localhost/data?call=https://search.gitee.com/?type=repository&amp;q=forest</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>{表达式}</code>产生的效果</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/data?call={url}&amp;x={x}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 最后产生的URL是</span>
    <span class="token comment">// http://localhost/data?call=https://search.gitee.com/?type=repository%26q=forest&amp;x=xxx</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="配置属性引用"><a href="#配置属性引用" class="header-anchor">#</a> 配置属性引用</h4> <p>自 <code>1.5.3</code> 版本起，Forest 支持在模板表达式中直接引用 Properties 配置中的任意属性值</p> <p>语法格式: 使用井号字符<code>#</code>跟一对花括号<code>{}</code>形式，将变量名包裹起来，如 <code>#{username}</code></p> <p>配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">mydata</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> foo
    <span class="token key atrule">password</span><span class="token punctuation">:</span> bar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>引用：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/?u=#{mydata.username}&amp;pwd=#{mydata.password}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 产生URL:</span>
    <span class="token comment">// http://localhost:8080/?u=foo&amp;pwd=bar</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="变量引用"><a href="#变量引用" class="header-anchor">#</a> 变量引用</h4> <p>模板表达式最原始的目的就是各种各样的数据动态绑定到HTTP请求的各个属性中，要完成这一步就要实现对外部数据的引用。</p> <p>Forest的模板表达式提供了两种最基本的数据引用方式： <code>变量名引用</code>、<code>参数序号引用</code></p> <p>如上面简单例子所示，表达式中可以直接引用<code>@Var</code>或 <code>@DataVariable</code> 所标注的变量名。除此之外也可以直接引用全局配置中定义的全局变量名</p> <p>全局变量：</p> <div class="language-ymal line-numbers-mode"><pre class="language-text"><code>forest:
  variables:
    a: foo
    b: bar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>全局变量引用：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/{a}/{b}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 产生的URL: http://localhost:8080/foo/bar</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数变量：</p> <p><code>@Var</code>注解的<code>value</code>属性为变量名</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/{a}/{b}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 产生的URL：http://localhost:8080/xxx/yyy</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>此外还有<strong>动态变量绑定</strong>、<strong>静态变量绑定</strong>、<strong>参数序号引用</strong>、<strong>引用对象属性</strong>、 <strong>调用对象方法</strong>等表达式用法</p> <h3 id="高级特性"><a href="#高级特性" class="header-anchor">#</a> 高级特性</h3> <h4 id="拦截器"><a href="#拦截器" class="header-anchor">#</a> 拦截器</h4> <blockquote><p>在很多个请求发送之前或之后做一些事情（如打印日志、计数等等），拦截器是个好帮手</p></blockquote> <h5 id="构建拦截器"><a href="#构建拦截器" class="header-anchor">#</a> 构建拦截器</h5> <p>定义一个拦截器需要实现<code>com.dtflys.forest.interceptor.Interceptor</code>接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleInterceptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInvokeMethod</span><span class="token punctuation">(</span><span class="token class-name">ForestRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ForestMethod</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">beforeExecute</span><span class="token punctuation">(</span><span class="token class-name">ForestRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterExecute</span><span class="token punctuation">(</span><span class="token class-name">ForestRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ForestResponse</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h5 id="配置拦截器"><a href="#配置拦截器" class="header-anchor">#</a> 配置拦截器</h5> <p>Forest有三个地方可以添加拦截器：<code>@Request</code>、<code>@BaseRequest</code>、全局配置，这三个地方代表三个不同的作用域</p> <p><strong>@Request上的拦截器</strong>：指定的拦截器只作用在指定的请求上</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SimpleClient</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * \@Request注解配置拦截器
     */</span>
    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/user?username=foo&quot;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Accept:text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            interceptor <span class="token operator">=</span> <span class="token class-name">SimpleInterceptor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">simple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * \@Request注解配置多个拦截器
     */</span>
    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/user?username=foo&quot;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Accept:text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            interceptor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">SimpleInterceptor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">SimpleInterceptor2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">simple2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>@BaseRequest 上的拦截器</strong>：<code>interface</code>内的所有请求方法都被会<code>SimpleInterceptor</code>和<code>SimpleInterceptor2</code>拦截器拦截</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * \@BaseRequest注解配置拦截器
 */</span>
<span class="token annotation punctuation">@BaseRequest</span><span class="token punctuation">(</span>
        baseURL <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">,</span>
        interceptor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">SimpleInterceptor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">SimpleInterceptor2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SimpleClient2</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;/hello/user1?username=foo&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Request</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;/hello/user2?username=foo&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>全局拦截器</strong>：全局生效</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">forest</span><span class="token punctuation">:</span>
  <span class="token key atrule">interceptors</span><span class="token punctuation">:</span>    <span class="token comment">#可配置1到多个拦截器</span>
     <span class="token punctuation">-</span> com.your.site.client.SimpleInterceptor1
     <span class="token punctuation">-</span> com.your.site.client.SimpleInterceptor2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="自定义注解"><a href="#自定义注解" class="header-anchor">#</a> 自定义注解</h4> <p>Forest提供了很多内置的注解，比如 <code>@Request</code>, <code>@Get</code>, <code>@DownloadFile</code> 等等。Forest对于请求接口的构建也是基于这些注解来工作的， 那么总有一些需求是光靠这些内置注解是满足不了的，比如公司内部定义的加签加密方式，自定义数据转换类型等等。</p> <p>自定义注解在技术结构上基于拦截器，本质上就是把拦截器封装成了一个个注解</p> <p><strong>定义一个注解</strong>：签名加密注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用Forest自定义注解实现一个自定义的签名加密注解
 * 凡用此接口修饰的方法或接口，其对应的所有请求都会执行自定义的签名加密过程
 * 而自定义的签名加密过程，由这里的@MethodLifeCycle注解指定的生命周期类进行处理
 * 可以将此注解用在接口类和方法上
 */</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token comment">/** 重点： @MethodLifeCycle注解指定该注解的生命周期类*/</span>
<span class="token annotation punctuation">@MethodLifeCycle</span><span class="token punctuation">(</span><span class="token class-name">MyAuthLifeCycle</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequestAttributes</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAuth</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>使用自定义注解</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyAuthClient</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 在请求接口上加上自定义的 @MyAuth 注解
     * 注解的参数可以是字符串模板，通过方法调用的时候动态传入
     * 也可以是写死的字符串
     */</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/hello/user?username=${username}&quot;</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Accept:text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@MyAuth</span><span class="token punctuation">(</span>username <span class="token operator">=</span> <span class="token string">&quot;${username}&quot;</span><span class="token punctuation">,</span> password <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="组合注解"><a href="#组合注解" class="header-anchor">#</a> 组合注解</h4> <p>Forest 除了能用生命周期来自定义注解外，也允许把已有的 Forest 注解组合成一个新的注解</p> <p><strong>组合一个注解</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用Forest组合注解实现一个自定义的请求头注解
 * 此注解加上了 @Headers 注解，并为注解的参数赋了值
 * 那么以后使用此注解的接口和方法，会自动添加上 @Headers 注解以及它的参数值
 */</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 被组合的注解</span>
<span class="token annotation punctuation">@Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">&quot;Accept: text/plain&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 在组合注解中可以在模板字符串中引用变量</span>
        <span class="token comment">// 它会从全局变量或方法的参数中获取变量值</span>
        <span class="token string">&quot;Token: ${token}&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyHeaders</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>使用组合后的注解</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyCombineAnnoClient</span> <span class="token punctuation">{</span>
    <span class="token comment">// 该方法使用了自定义的组合注解 @MyHeaders</span>
    <span class="token comment">// 所以该方法发送的请求会自动添加以下请求头:</span>
    <span class="token comment">// Accept: text/plain</span>
    <span class="token comment">// Content-Type: application/json</span>
    <span class="token comment">// Token: xxx (从形参 token 中传入的值)</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@MyHeaders</span>
    <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Var</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>组合多个注解</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Forest 可以同时组合多个注解
 * 如方法使用该自定义的 @MySite 注解
 * 那么就等同使用这里被组合的 @Headers 注解和 @Address 注解
 * 以及它们的参数值
 */</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 组合第一个注解</span>
<span class="token annotation punctuation">@Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;Accept: text/plain&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Type: application/json&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 组合第二个注解</span>
<span class="token comment">// 可以从全局变量或方法参数中获取变量值</span>
<span class="token annotation punctuation">@Address</span><span class="token punctuation">(</span>host <span class="token operator">=</span> <span class="token string">&quot;${my-site.host}&quot;</span><span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token string">&quot;${my-site.port}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MySite</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>注意</p> <p>定义组合注解的时候要注解不要组合自身，以及组合过自身的其它注解，以免引起循环引用</p></blockquote> <h4 id="自定义转换器"><a href="#自定义转换器" class="header-anchor">#</a> 自定义转换器</h4> <p>在Forest中，每个转换类型都对应一个转换器对象，比如<code>JSON</code>格式的转换器有<code>ForestFastjsonConverter</code>、<code>ForestGsonConverter</code>、<code>ForestJacksonConverter</code>三种，分别是基于<code>FastJson</code>、<code>Gson</code>、<code>Jackson</code>三种不同的<code>JSON</code>序列化框架。</p> <p>当然也支持自定义转换器，以适应自己项目的需要。</p> <p><strong>第一步</strong>：实现 ForestConverter 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 *  自定义一个Protobuf的转换器，并实现ForestConverter接口下的convertToJavaObject方法
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProtobufConverter</span> <span class="token keyword">implements</span> <span class="token class-name">ForestConverter</span><span class="token punctuation">,</span> <span class="token class-name">ForestEncoder</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertToJavaObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> targetType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将字符串参数source转换成目标Class对象</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">convertToJavaObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> source<span class="token punctuation">,</span> <span class="token class-name">Type</span> targetType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将字符串参数source转换成目标Type(可能是一个泛型类型)对象</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>第二步</strong>：注册全局自定义转换器</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># JSON转换器</span>
<span class="token comment"># JSON转换器设置为MyJsonConverter转换器</span>
<span class="token attr-name">forest.converters.json.type</span><span class="token punctuation">=</span><span class="token attr-value">com.xxx.MyJsonConverter</span>
<span class="token comment"># XML转换器</span>
<span class="token comment"># 配置为MyXmlConverter转换器</span>
<span class="token attr-name">forest.converters.xml.type</span><span class="token punctuation">=</span><span class="token attr-value">com.xxx.MyXmlConverter</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>第三步</strong>：接口/方法级别引用自定义转换器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 接口级别转换器定义</span>
<span class="token annotation punctuation">@BodyType</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;protobuf&quot;</span><span class="token punctuation">,</span> encoder <span class="token operator">=</span> <span class="token class-name">MyProtobufConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyClient</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法级别转换器定义</span>
    <span class="token annotation punctuation">@Get</span><span class="token punctuation">(</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@BodyType</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">&quot;protobuf&quot;</span><span class="token punctuation">,</span> encoder <span class="token operator">=</span> <span class="token class-name">MyProtobufConverter2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Body</span> <span class="token class-name">MyData</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">2023/05/19, 03:33:46</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#一、forest基本介绍" class="sidebar-link reco-side-一、forest基本介绍" data-v-cb1513f6>一、Forest基本介绍</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#什么是-forest" class="sidebar-link reco-side-什么是-forest" data-v-cb1513f6>什么是 Forest？</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#为什么使用-forest" class="sidebar-link reco-side-为什么使用-forest" data-v-cb1513f6>为什么使用 Forest?</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#forest-如何使用" class="sidebar-link reco-side-forest-如何使用" data-v-cb1513f6>Forest 如何使用?</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#forest-的工作原理" class="sidebar-link reco-side-forest-的工作原理" data-v-cb1513f6>Forest 的工作原理</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#forest-的架构" class="sidebar-link reco-side-forest-的架构" data-v-cb1513f6>Forest 的架构</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#所需环境" class="sidebar-link reco-side-所需环境" data-v-cb1513f6>所需环境</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#名字由来" class="sidebar-link reco-side-名字由来" data-v-cb1513f6>名字由来</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#特点" class="sidebar-link reco-side-特点" data-v-cb1513f6>特点</a></li><li class="level-2" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#二、极速入门" class="sidebar-link reco-side-二、极速入门" data-v-cb1513f6>二、极速入门</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#第一步-添加maven依赖" class="sidebar-link reco-side-第一步-添加maven依赖" data-v-cb1513f6>第一步：添加Maven依赖</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#第二步-创建接口" class="sidebar-link reco-side-第二步-创建接口" data-v-cb1513f6>第二步：创建接口</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#第三步-扫描接口" class="sidebar-link reco-side-第三步-扫描接口" data-v-cb1513f6>第三步：扫描接口</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#第四步-调用接口" class="sidebar-link reco-side-第四步-调用接口" data-v-cb1513f6>第四步：调用接口</a></li><li class="level-2" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#三、安装配置说明" class="sidebar-link reco-side-三、安装配置说明" data-v-cb1513f6>三、安装配置说明</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#如何安装" class="sidebar-link reco-side-如何安装" data-v-cb1513f6>如何安装</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#如何配置" class="sidebar-link reco-side-如何配置" data-v-cb1513f6>如何配置</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#如何使用" class="sidebar-link reco-side-如何使用" data-v-cb1513f6>如何使用</a></li><li class="level-2" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#四、声明式开发模式" class="sidebar-link reco-side-四、声明式开发模式" data-v-cb1513f6>四、声明式开发模式</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#第一步-定义java接口" class="sidebar-link reco-side-第一步-定义java接口" data-v-cb1513f6>第一步：定义Java接口</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#第二步-调用接口" class="sidebar-link reco-side-第二步-调用接口" data-v-cb1513f6>第二步：调用接口</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#请求代码解析" class="sidebar-link reco-side-请求代码解析" data-v-cb1513f6>请求代码解析</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#接收数据" class="sidebar-link reco-side-接收数据" data-v-cb1513f6>接收数据</a></li><li class="level-2" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#五、编程式开发模式" class="sidebar-link reco-side-五、编程式开发模式" data-v-cb1513f6>五、编程式开发模式</a></li><li class="level-2" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#六、模板表达式和高级特性" class="sidebar-link reco-side-六、模板表达式和高级特性" data-v-cb1513f6>六、模板表达式和高级特性</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#模板表达式" class="sidebar-link reco-side-模板表达式" data-v-cb1513f6>模板表达式</a></li><li class="level-3" data-v-cb1513f6><a href="/wxblog/spring/forest/Forest%E4%BD%BF%E7%94%A8%E5%88%86%E4%BA%AB.html#高级特性" class="sidebar-link reco-side-高级特性" data-v-cb1513f6>高级特性</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div></div><canvas id="vuepress-canvas-cursor"></canvas><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 wblog
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/wxblog/assets/js/app.3804bf2c.js" defer></script><script src="/wxblog/assets/js/3.a8328e8d.js" defer></script><script src="/wxblog/assets/js/1.400ebb5b.js" defer></script><script src="/wxblog/assets/js/28.effcadf8.js" defer></script>
  </body>
</html>
